#! /usr/bin/env ruby
# coding: utf-8
#
# USAGE: formcolumn [options] files ...

require "pp"
require "optparse"
require "rubygems"
require "tefil"

# option analysis
OPTIONS = {}
op = OptionParser.new
#op.banner = [
#    "Usage: #{File.basename("#{__FILE__}")} [options] [files]",
#].join("\n")
op.on("-o"     , "--overwrite"     , "Overwrite."){    OPTIONS[:overwrite] = true}
op.on("-m", "--minimum", "Show only minimum indent (not zero)."){ OPTIONS[:minimum] = true}
#op.on("-l"     , "--left-alline"   , "Left alline."){ OPTIONS[:left] = true}
op.parse!(ARGV)

module Tefil
  def self.process_stream(in_io, out_io)
    #rows = in_io.readlines.map { |line| line.strip.split(INPUT_SEPARATOR) }
    #Tefil::ColumnFormer.form(rows, out_io, OPTIONS[:separator], OPTIONS[:left])
    frequencies = {}
    in_io.readlines.each do |line|
        #/^(\s*)/ =~ line #改行文字が含まれる。
        /^( *)/ =~ line
        width = $1.size
        frequencies[width] ||= 0
        frequencies[width] += 1
    end

    if OPTIONS[:minimum]
        frequencies.delete(0)
        output = frequencies.keys.sort[0]
        #frequencies.keys.sort.each do |key|
        #    if frequencies[key] != 0
        #        output = key
        #        break
        #    end
        #end
    else
        output = self.histgram(frequencies)
    end
    #pp output

    out_io.puts output
  end

  def self.histgram(frequencies)
      result = ''
      frequencies.keys.sort.each do |key|
          result += sprintf("%2d|", key)
          result += "*" * frequencies[key]
          result += "\n"
      end
      result
  end
end

OPTIONS[:overwrite] ||= false

Tefil.run(ARGV, OPTIONS[:overwrite])
